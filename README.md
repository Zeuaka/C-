# ЛАБОРАТОРНАЯ РАБОТА №6 
## LINQ-ЗАПРОСЫ

**Задание 1. Кот** 

# 1 Кот мяукает.

Создайте сущность Кот, которая описывается следующим образом:

• Имеет Имя (строка)

• Для создания необходимо указать имя кота.

• Может быть приведен к текстовой форме вида: “кот: Имя”

• Может помяукать, что приводит к выводу на экран следующего текста: “Имя: мяу!”,

вызвать мяуканье можно без параметров.

• Может помяукать N раз, что приводит к выводу на экран следующего текста: “Имя: мяумяу-…-мяу!”, где количество “мяу”равно N.

Создайте кота по имени “Барсик”, и затем пусть он помяукает сначала один раз, а затем три раза.

# 2 Интерфейс Мяуканье.

Разработайте метод, который принимает набор объектов способных мяукать и вызывает мяуканье у

каждого объекта. Мяукающие объекты должны иметь метод со следующей сигнатурой:

public void meow();

Дополните решение предыдущей задачи так, чтобы иметь возможность передать Кота в написанный

вами метод и протестируйте работоспособность решения передав в него нескольких котов, а также

создайте любой другой произвольный класс и передайте в написанный метод его объекты.

# 3 Количество мяуканий.

Необходимо воспользоваться классом Кот и методом принимающим всех мяукающих из предыдущего

задания. Необходимо таким образом передать кота в указанный метод, что бы после окончания его

работы узнать сколько раз мяукал кот за время его работы. На рисунке показан пример работы. Перед

вызовом метода создаем кота, отправляем ссылку на кота в метод, после окончания его работы

выводим количество мяуканий на экран. Кота изменять нельзя

<img width="852" height="76" alt="image" src="https://github.com/user-attachments/assets/7fd5d2ab-932a-4d25-af21-588422d1f2c9" />



## Решение задачи состоит из 4-х файлов: 

ProductActs.cs для описания обьекта КОТ и его методов (мяуканье)

LINQ.cs для формирования структуры LINQ запросов, а так же работы с exel,

А так же Program.cs, который содержит основной метод main и методы для добавления элементов в таблицы 

---

### ***Файл: ProductActs.cs***

### Класс ProductMovement

Хранит информацию о всех операциях с товарами (поступления, продажи, возвраты)

### Класс Product

Хранит основные характеристики товаров

### Класс Store

Хранит информацию о магазинах

### Класс Category

Хранит категории товаров с возрастными ограничениями



Так же для каждого класса описаны методы ToString для корректного вывода обьектов классов

---


### ***Файл: LINQ.cs***

Основные компоненты класса:

### Приватные поля:

_movements, _products, _stores, _categories — коллекции для хранения данных.

_filePath — путь к Excel-файлу.

_nextMovementId, _nextProductArticle, _nextStoreId, _nextCategoryId — счетчики для генерации уникальных идентификаторов.

Конструктор:

Инициализирует коллекции и устанавливает контекст лицензии EPPlus.

Вызывает метод CreateTestData() для заполнения тестовыми данными.

---

### ReadFromExcel()

Назначение: Загружает данные из Excel-файла в соответствующие коллекции.

### Алгоритм:

Проверяет существование файла.

Очищает текущие коллекции.

Читает данные из листов: "Категория", "Магазин", "Товар", "Движение товаров".

***Алгоритм работы:***

Циклом проходит по всем строкам листа, разбивает данные из ячеек, попутно проверяя их заполненность.

Далее добавляет запись в подходящий список данных из полей класса.



Обновляет счетчики идентификаторов.

***Алгоритм работы:***

За каждый элемент в списках полей класса, увеличивает константные значения полей класса на 1

---


### CreateTestData()

Создает тестовые данные

### ViewData(string tableName)

Метод отображает в консоли данные выбранной таблицы

***Алгоритм работы:***

В зависимости от переданного tableName, срабатывает один з 5 кейсов:

---

## Обработка случая "movements" (Движение товаров)

Если движений нет - выводится сообщение и инициализируется выход из метода

Для КАЖДОГО движения товара выполняются следующие действия:

С помощью цикла foreach (var movement in _movements) 

Находится товар по артикулу из движения

Находится магазин по ID из движения

так как по этим полям данные таблицы связаны.

Далее выводится информация о движении + название товара + район магазина

---

Дальнейший механизм работы для других кейсов подразумевает такой же принцип работы, с небольшими правками.

---

## Обработка случая "products" (Товары)

Для каждого товара находится его категория по CategoryId

Выводится товар + название категории

## Обработка случая "stores" (Магазины) и "categories" (Категории)

Просто выводится каждый магазин или категория

все форматы вывода уже описаны в классе ProductActs, поэтому вывод останется информативным.

---


### DeleteItem(string tableName, int id)

Метод для удаления записи из таблицы

Работа метода так же зависит от переданного tableName и подразумевает работу с кейсами:

## Обработка случая "movements"

***Алгоритм работы:***

Совершается проход по всем записанным движениям, в поисках того, чей id совпадет с переданным методу.

После чего происходит простое удаление записи из коллекции с movements

## Обработка случая "products"

***Алгоритм работы:***

Здесь все сложнее, так как от таблицы products так же зависят записи в movements.

Алгоритм поиска товара остается таким же, как и поиск движения товара, однако добавляется еще

проход по всем движениям, в которых фигурировал id товара. Найденные движения формируются в отдельный список,

после чего последовательно удаляются из коллекции movements

## Обработка случая "stores"

***Алгоритм работы:***

Имеет такой же алгоритм работы, как и в случае с products, однако поиск движений

происходит уже по id магазина.

## Обработка случая "categories"

***Алгоритм работы:***

Самый сложный случай, сначала по обычному сценарию удаляется категория товара,

после чего, уже с помощью вложенного цикла foreach происходит удаление всех товаров,

подходящих по данную категорию. Далее вкладывается еще один цикл foreach, еще ниже уровнем,

в котором последовательно удаляются движения, в которых фигурировали данные товары.

---

### Методы добавления записей:

## Добавление движения товара:

Запрашивает у пользователя данные о айди товара и магазина, после чего проверяет существование таковых.

После чего добавляет запись в коллекцию с движениями

## Добавление товара:

Запрашивает у пользователя данные о айди категории, после чего проверяет ее существование.

После чего добавляет запись в коллекцию с товарами

## Добавление категории или магазина:

Записи в этих таблицах являются независимыми и не требуют никаких проверок.

---

### LINQ Запросы

Запросы выполняются с помощью API IEnurable, который позволяет интегрировать 

## GetSalesWithCustomerCards() (запрос с обращением к одной таблице)

Запрос обращается к таблице с движениями и выводит все, где тип операции продажа, а в поле с картой покупателя выставлено "да"

## GetTotalSales() (запрос с обращением к двум таблицам)

Запрос выбирает количество проданного товара из таблицы с движениями и стоимость товара из таблицы с товарами.

после чего перемножает количества на цены и суммирует их

## GetAveragePriceByAgeGroup()

Объединяем товары с категориями (чтобы знать возрастную группу товара)

Объединяем товары с движениями (чтобы учитывать только поступившие товары)

Результат: "Виртуальная таблица" со всеми полями из товаров, категорий и движений

Оставляем только записи, где тип операции = "Поступление"

Группируем все товары по полю AgeRestriction из категорий

Например: все товары с возрастной группой "17+" попадают в одну группу

Для каждой группы вычисляем среднюю цену товаров

Этот запрос показывает, сколько в среднем стоят товары в каждой возрастной категории, учитывая только те товары, которые были поставлены в магазины.

## GetTotalSalesInWalkerDistrict()

Обьединям Движения + Магазины - чтобы узнать в каком районе была продажа

Обьединям Движения + Товары - чтобы узнать цену проданного товара

Оставляем только записи, где тип операции только "Продажи", 

а район только Дзержинский

Выбираем из получившейся таблицы только количество проданных упаковок и цену упаковки 

Далее вычисляем общую сумму продаж

---

### SaveToExcel()

Создается пустой Excel-файл в памяти

По умолчанию содержит один пустой лист

Берется первый лист (индекс 0) и переименовывается в "Категория"

Первая строка заполняется названиями столбцов.

Далее осуществляется проход по всем категориям с помощью цикла, который заканчивается, когда счетчкик достигает конца коллекции с категориями.

Строки заполняются данными

Для остальных листов алгоритм остается одинаковым

---

---

---

Ниже представлены примеры работы программы.


<img width="386" height="313" alt="image" src="https://github.com/user-attachments/assets/596e7e97-15bd-4126-b92f-c6b3f2b6db19" />


<img width="1105" height="353" alt="image" src="https://github.com/user-attachments/assets/1decb73c-4717-440d-8683-5fc06080771f" />


<img width="880" height="313" alt="image" src="https://github.com/user-attachments/assets/40fc06f1-3aee-408d-9da5-27bdcb511252" />


<img width="522" height="281" alt="image" src="https://github.com/user-attachments/assets/19666eda-5447-4494-8007-befabdd05233" />


<img width="414" height="286" alt="image" src="https://github.com/user-attachments/assets/2ec901b3-efcf-4525-b470-1ccef5476ecd" />


<img width="426" height="284" alt="image" src="https://github.com/user-attachments/assets/f14b0de2-ae94-43fa-8dd5-986a2a21fc92" />

