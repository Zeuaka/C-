# ЛАБОРАТОРНАЯ РАБОТА №5 
## LINQ-ЗАПРОСЫ

**Вариант 1** 
В файле LR5-var1.xls приведён фрагмент базы данных «Детские товары» о поставках товаров в 
магазины районов города. База данных состоит из четырёх таблиц. Таблица «Движение товаров» 
содержит записи о поставках товаров в магазины в августе 2024 г., а также информацию о проданных 
товарах. Поле Тип операции содержит значение «Поступление», «Продажа» или «Возврат», а в 
соответствующее поле «Количество упаковок» занесена информация о том, сколько упаковок товара 
поступило в магазин или было продано в течение дня; поле «Наличие карты клиента» содержит 
значение Да или Нет. Таблица «Товар» содержит информацию об основных характеристиках каждого 
товара. Таблица «Магазин» содержит информацию о местонахождении магазинов. Таблица 
«Категория» содержит данные о категориях товаров и соответствующие возрастные ограничения. На 
рисунке приведена схема указанной базы данных.


<img width="345" height="215" alt="image" src="https://github.com/user-attachments/assets/b5a4b032-8c95-4f62-8ab7-0156808a548f" />


Программа состоит из 3-х файлов: 

ProductActs.cs для описания классов обьектов, с которыми проводится работа, а также перегрузки

их вывода в консоль,

LINQ.cs для формирования структуры LINQ запросов, а так же работы с exel,

А так же Program.cs, который содержит основной метод main и методы для добавления элементов в таблицы 

---

### ***Файл: LINQ.cs***

Основные компоненты класса:

### Приватные поля:

_movements, _products, _stores, _categories — коллекции для хранения данных.

_filePath — путь к Excel-файлу.

_nextMovementId, _nextProductArticle, _nextStoreId, _nextCategoryId — счетчики для генерации уникальных идентификаторов.

Конструктор:

Инициализирует коллекции и устанавливает контекст лицензии EPPlus.

Вызывает метод CreateTestData() для заполнения тестовыми данными.

---

### ReadFromExcel()

Назначение: Загружает данные из Excel-файла в соответствующие коллекции.

### Алгоритм:

Проверяет существование файла.

Очищает текущие коллекции.

Читает данные из листов: "Категория", "Магазин", "Товар", "Движение товаров".

***Алгоритм работы:***

Циклом проходит по всем строкам листа, разбивает данные из ячеек, попутно проверяя их заполненность.

Далее добавляет запись в подходящий список данных из полей класса.



Обновляет счетчики идентификаторов.

***Алгоритм работы:***

За каждый элемент в списках полей класса, увеличивает константные значения полей класса на 1

---


### CreateTestData()

Создает тестовые данные

### ViewData(string tableName)

Метод отображает в консоли данные выбранной таблицы

***Алгоритм работы:***

В зависимости от переданного tableName, срабатывает один з 5 кейсов:

---

## Обработка случая "movements" (Движение товаров)

Если движений нет - выводится сообщение и инициализируется выход из метода

Для КАЖДОГО движения товара выполняются следующие действия:

С помощью цикла foreach (var movement in _movements) 

Находится товар по артикулу из движения

Находится магазин по ID из движения

так как по этим полям данные таблицы связаны.

Далее выводится информация о движении + название товара + район магазина

---

Дальнейший механизм работы для других кейсов подразумевает такой же принцип работы, с небольшими правками.

---

## Обработка случая "products" (Товары)

Для каждого товара находится его категория по CategoryId

Выводится товар + название категории

## Обработка случая "stores" (Магазины) и "categories" (Категории)

Просто выводится каждый магазин или категория

все форматы вывода уже описаны в классе ProductActs, поэтому вывод останется информативным.

---


### DeleteItem(string tableName, int id)

Метод для удаления записи из таблицы

Работа метода так же зависит от переданного tableName и подразумевает работу с кейсами:

## Обработка случая "movements"

***Алгоритм работы:***

Совершается проход по всем записанным движениям, в поисках того, чей id совпадет с переданным методу.

После чего происходит простое удаление записи из коллекции с movements

## Обработка случая "products"

***Алгоритм работы:***

Здесь все сложнее, так как от таблицы products так же зависят записи в movements.

Алгоритм поиска товара остается таким же, как и поиск движения товара, однако добавляется еще

проход по всем движениям, в которых фигурировал id товара. Найденные движения формируются в отдельный список,

после чего последовательно удаляются из коллекции movements

## Обработка случая "stores"

***Алгоритм работы:***

Имеет такой же алгоритм работы, как и в случае с products, однако поиск движений

происходит уже по id магазина.

## Обработка случая "categories"

***Алгоритм работы:***

Самый сложный случай, сначала по обычному сценарию удаляется категория товара,

после чего, уже с помощью вложенного цикла foreach происходит удаление всех товаров,

подходящих по данную категорию. Далее вкладывается еще один цикл foreach, еще ниже уровнем,

в котором последовательно удаляются движения, в которых фигурировали данные товары.

---

### Методы добавления записей:

## Добавление движения товара:

Запрашивает у пользователя данные о айди товара и магазина, после чего проверяет существование таковых.

После чего добавляет запись в коллекцию с движениями

## Добавление товара:

Запрашивает у пользователя данные о айди категории, после чего проверяет ее существование.

После чего добавляет запись в коллекцию с товарами

## Добавление категории или магазина:

Записи в этих таблицах являются независимыми и не требуют никаких проверок.

---

### LINQ Запросы

## GetSalesWithCustomerCards()



### **Задание 3**

#### **Задача 1**  

В городе имеется n общеобразовательных учебных заведений, которые могут закупать

компьютерную технику и оргтехнику. Есть перечень компьютерных фирм, где может 

производиться закупка. Ответить на следующие вопросы: 

1) в каких фирмах закупка производилась каждым из заведений?

2) в каких фирмах закупка производилась хотя бы одним из заведений?
 
3) в каких фирмах ни одно из заведений не закупало компьютеры?

**Алгоритм работы:**  
Решение вопроса 1: "Фирмы, где закупка производилась КАЖДЫМ из заведений" 

Создаем копию множества всех фирм

Для каждого учебного заведения выполняем операцию пересечения (IntersectWith)

В результате остаются только фирмы, которые присутствуют в списках ВСЕХ заведений

Решение вопроса 2: "Фирмы, где закупка производилась ХОТЯ БЫ ОДНИМ из заведений"

Создаем пустое множество

Для каждого учебного заведения выполняем операцию объединения (UnionWith)

В результате получаем все фирмы, где закупался хотя бы один из заведений

Решение вопроса 3: "Фирмы, где НИ ОДНО из заведений не закупало компьютеры"

Создаем копию множества всех фирм

Выполняем операцию разности (ExceptWith) с множеством фирм, где закупался хотя бы один

В результате остаются фирмы, которые есть в общем списке, но отсутствуют в списке закупок

---

### **Задание 4**

#### **Задача 1**  
Файл содержит текст на русском языке. Напечатать в алфавитном порядке все звонкие 

согласные буквы, которые входят хотя бы в одно слово.

**Алгоритм работы:**  

Весь текст из файла считывается в строковую переменную с указанием кодировки UTF-8

Создается HashSet с набором звонких согласных букв русского языка

Создается пустой HashSet для хранения найденных уникальных согласных

Определяется массив разделителей: пробелы, знаки препинания и символы форматирования

Текст разбивается на слова с удалением пустых элементов

Слова преобразуется к нижнему регистру, Если символ в слове является звонкой согласной, он добавляется в коллекцию найденных согласных

Найденные согласные преобразуются в список для возможности сортировки

Список сортируется в алфавитном порядке

---

### **Задание 5**  

#### **Задача 1**  
На вход программы подаются фамилии и имена учеников. Известно, что общее количество 

учеников не превосходит 100. В первой строке вводится количество учеников, принимавших 

участие в соревнованиях, N. Далее следуют N строк, имеющих следующий формат:

<Фамилия><Имя>

Здесь <Фамилия> – строка, состоящая не более чем из 20 символов; <Имя>– строка, состоящая не 

более чем из 15 символов. При этом <Фамилия> и <Имя> разделены одним пробелом. Примеры

входных строк: 

***Иванова Мария***

***Петров Сергей***

Требуется написать программу, которая формирует и печатает уникальный логин для каждого 

ученика по следующему правилу: если фамилия встречается первый раз, то логин – это данная 

фамилия, если фамилия встречается второй раз, то логин – это фамилия, в конец которой 

приписывается число 2 и т.д. Например, для входной последовательности:

***Иванова Мария***

***Петров Сергей***

***Бойцова Екатерина***

***Петров Иван***

***Иванова Наташа***

будут сформированы следующие логины:

***Иванова***

***Петров***

***Бойцова***

***Петров2***

***Иванова2***


**Алгоритм работы:**  

### Инициализация пути к файлу

Определяется путь к файлу с данными студентов (students.txt)

### Создание файла с исходными данными

Вызывается метод CreateStudentsFile для создания файла с тестовыми данными студентов

В файл записываются ФИО студентов в формате "Фамилия Имя"

### Чтение данных из файла

Вызывается метод ReadStudentsFromFile для чтения всех записей из файла

Если файл не существует, метод вернет пустой массив

### Проверка наличия данных

Если массив студентов пустой (длина равна 0), выводится сообщение об отсутствии данных и метод завершает работу

### Генерация логинов

Вызывается метод GenerateLogins для создания словаря "студент → логин"

Для каждого студента генерируется уникальный логин на основе фамилии

### Сохранение результатов в файл

Вызывается метод SaveLoginsToFile для записи всех сгенерированных логинов в файл logins.txt

Каждая строка файла содержит соответствие "ФИО студента -> логин"

---

### **Задание 6**  

#### **Задача 1**  
Необходимо создать класс Time, с полями byte hours и byte minutes, 

Также для класса необходимо задать методы :
Добавление произвольного количества минут (uint) к объекту типа Time.
Результат должен быть типа Time.

Наконец необходимо перегрузить ToString для форматного вывода даты. 


**Алгоритм работы:**  
Для приватных полей класса реализованы геттеры и сеттеры, с проверкой на валидность данных ("Часы должны быть в диапазоне 0-23"), 

("Минуты должны быть в диапазоне 0-59")

Также реализованы конструкторы по умолчанию, или с переданными для полей данными.

### Метод добавления минут:

Принимает uint значение минут, после чего переводит все данные исходного времени (к которому необходимо добавить минуты)

в минуты. Далее происходит сложение числовых значений, а полученный результат с помощью операций деления и получения остатка

приводится к формату ЧЧ:ММ

### Метод ToString:

Возвращает строку, в которую помещены публичные значения приватных полей hours и minutes

---

### **Задание 7**  

#### **Задача 1**  
Расширение функционала класса Time.

Необходимо добавить:

### Унарные операции:

++ добавление минуты к объекту типа Time

-- вычитание минуты из объекта типа Time

### Операции приведения типа:

byte (явная) – результатом является количество часов (минуты 
отбрасываются);

bool (неявная) – результатом является true, если часы и минуты не равны 
нулю, и falseв противном случае.

### Бинарные операции:

+ Time t, беззнаковое целое число (минуты) (лево- и правосторонние 
операции). Результат должен быть типа Time.

– Time t, беззнаковое целое число (минуты) (лево- и правосторонние 
операции).Результат должен быть типа Time.

**Алгоритм работы:**  
### Унарные операции:

++: реализован с помощью уже введенного метода добавления минут из 6 задания, 

для перегрузки этого оператора возвращаем метод для обьекта time с 1 в переданном параметре

--: для работы перегрузки данного оператора необходимо ввести метод для вычитания минут. 

Алгоритм работы данного метода остается таким же, как для операции сложения, однако нам так же необходимо учитывать, что вычитание

может дать отрицательный результат, что будет означать переход на другие сутки. Данная проблема решается циклом while с последующим 

прибавлением к результату вычитания минут = 24 * 60, пока результат не превысит 0.

### Операции приведения типа:

byte (явная): возвращаем публичное значение поля hours для обьекта time

bool (неявная): производим сравнение с 0 публичных значений каждого поля обьекта time и возвращаем результат сравнения

### Бинарные операции:

+: порядок для операции не важен, всегда возвращаем конструкцию time.AddMinutes(minutes);

-: для случая, когда мы из какого-либо количества минут вычитаем обьект time, нам необходимо сначала создать новый обьект time1,

после чего прибавить к нему необходимые минуты, и уже из получившегося обьекта вычитать числовое значение минут обьекта time

---

---

Ниже представлены примеры работы программы в каждом из разделов заданий.


### Задание 1

<img width="411" height="94" alt="image" src="https://github.com/user-attachments/assets/74aa42e9-788a-4d26-bfc4-b2bf5297d2d1" />



### Задание 2

<img width="425" height="89" alt="image" src="https://github.com/user-attachments/assets/b5956f5a-1045-4100-9127-31b926d6df88" />



### Задание 3

<img width="448" height="279" alt="image" src="https://github.com/user-attachments/assets/d94977e5-cb20-46b0-82f8-475776fbd8bc" />



### Задание 4

<img width="442" height="245" alt="image" src="https://github.com/user-attachments/assets/e366a859-aa04-4058-b42d-eb900a904ec5" />


### Содержимое TXT файла :

<img width="520" height="97" alt="image" src="https://github.com/user-attachments/assets/85ea870a-64fd-49eb-9c26-509634929c6f" />


### Задание 5

<img width="397" height="222" alt="image" src="https://github.com/user-attachments/assets/c4306939-c09e-4567-bf9b-6a8daf15cd33" />


### Содержимое TXT файла students :

<img width="393" height="190" alt="image" src="https://github.com/user-attachments/assets/7b203ec2-efd4-45eb-9a81-58a75554e7fb" />


### Содержимое TXT файла logins :

<img width="387" height="171" alt="image" src="https://github.com/user-attachments/assets/e669e792-6691-4ef6-96f8-d86608953cd1" />


### Задания 6-7

<img width="536" height="247" alt="image" src="https://github.com/user-attachments/assets/785fcf4f-32e7-44ec-8002-98dd9b7e2355" />


<img width="544" height="237" alt="image" src="https://github.com/user-attachments/assets/81574576-c911-46e3-9e30-bdc7f19d2abc" />


<img width="420" height="258" alt="image" src="https://github.com/user-attachments/assets/20a8cd45-6889-4c22-8b31-96e766faafa2" />


<img width="393" height="310" alt="image" src="https://github.com/user-attachments/assets/6ab29f8c-af2c-4274-a6ba-d1ed842490fd" />




